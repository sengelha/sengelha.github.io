// streaming-percentiles Version 1.0.0. Copyright 2018 Steven Engelhardt <sengelha@gmail.com>.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.streamingPercentiles=t.streamingPercentiles||{})}(this,function(t){"use strict";const e=999999;class i{constructor(t){this.epsilon=t,this.one_over_2e=1/(2*t),this.S=[],this.n=0}insert(t){this.n%this.one_over_2e==0&&this._compress(),this._do_insert(t),++this.n}quantile(t){for(var e=this.epsilon*this.n,i=Math.ceil(t*this.n),s=0,n=0;n<this.S.length;++n){var r=(s+=this.S[n].g)+this.S[n].delta;if(i-s<=e&&r-i<=e)return this.S[n].v}throw"Could not resolve quantile"}_compress(){for(var t=2*this.epsilon*this.n,e=i._construct_band_lookup(t),s=this.S.length-2;s>=1;--s)if(e[this.S[s].delta]<=e[this.S[s+1].delta]){for(var n=s,r=this.S[s].g;n>=2&&e[this.S[n-1].delta]<e[this.S[s].delta];)--n,r+=this.S[n].g;if(r+this.S[s+1].g+this.S[s+1].delta<t){var o={v:this.S[s+1].v,g:r+this.S[s+1].g,delta:this.S[s+1].delta};this.S.splice(n,s-n+2,o),s=n}}}static _construct_band_lookup(t){var i=Array(t+1);i[0]=e,i[t]=0;for(var s=Math.floor(t),n=1;n<=Math.ceil(Math.log2(t));++n){var r=Math.pow(2,n-1),o=Math.pow(2,n),h=s-o-s%o;h<0&&(h=0);for(var a=s-r-s%r,l=h+1;l<=a;++l)i[l]=n}return i}_do_insert(t){var e=this._find_insertion_index(t),i={v:t,g:1,delta:this._determine_delta(e)};this.S.splice(e,0,i)}_find_insertion_index(t){for(var e=0;e<this.S.length&&t>=this.S[e].v;)++e;return e}_determine_delta(t){return this.n<this.one_over_2e?0:0==t||t==this.S.length?0:Math.floor(2*this.epsilon*this.n)-1}}t.GK=i,t.GK_MAX_BAND=e,Object.defineProperty(t,"__esModule",{value:!0})});